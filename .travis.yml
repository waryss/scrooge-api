language: java

sudo: false

# trusty is required for oraclejdk9
dist: trusty

services:
  - docker

install: true

jobs:
  include:
    - stage: build on docker
      script:
        - docker build -t scrooge-api .
    - stage: start docker image
      script:
        - docker run -p 8089:8089 -it scrooge-api .
        - IMG_PID=$(docker ps | grep scrooge-api | awk -F ' ' '{print $1}')
        - docker stop $IMG_PID
    - stage: package
      script:
        # tests are executed on docker build stage
        - mvn clean package -DskipTests=true

after_success:
  - mvn jacoco:report coveralls:report